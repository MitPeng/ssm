var masterGuy={categoryBarScroll:function(){var t=!1;return function(o,e,n,a){var r=$(".nav"),s=!1;t||(t=!0,o&&$(window).on("scroll",function(){$("body").scrollTop()>=o||document.documentElement.scrollTop>=o?s||(s=!0,r.addClass("retract").animate({top:0},200),n&&n()):(0!=$("body").scrollTop()&&$("body").scrollTop()<=e||0!=document.documentElement.scrollTop&&document.documentElement.scrollTop<=e||0==$("body").scrollTop()&&0==document.documentElement.scrollTop)&&s&&(s=!1,r.stop().removeAttr("style").removeClass("retract"),a&&a())}))}}(),categoryWidth:function(){for(var t=$(".nav-main>ul"),o=0;o<t.length;o++)t.eq(o).find(".nav-sub").last().addClass("nav-lastSub")},setData:function(t,o){var e=$('<img class="none" src="" />'),n=setTimeout(function(){a=!1,o()},500),a=!0;e.on("load",function(){clearTimeout(n),a&&o()}).on("error",function(){clearTimeout(n),a&&o()}).attr("src",t),$("body").append(e)},randomStr:function(t){t=t||36;for(var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;t>n;n++)e+=o.charAt(Math.floor(Math.random()*o.length));return e},assemblyParam:function(t){var o="https://trace.biyao.com/by.gif",e=o+"?",n=function(){return $.cookie("uuid")||masterGuy.randomStr(36)},a=function(){return $.cookie("uid")||""},r=function(){return"3-"+(new Date).getTime()+"-"+cipher(s.uu).substring(0,16)},s={pf:"pc",uu:n(),u:a(),av:"",d:"",osv:"",dw:window.screen.width,dh:window.screen.height},i={lt:"pc-ub",lv:"1.0",ubid:r(),pclk:"",pclkp:"",pn:"",pnp:""},c="";for(var l in s)s.hasOwnProperty(l)&&(e+=l+"="+encodeURIComponent(s[l])+"&");for(var u=0;u<t.length;u++){for(var d in t[u])t[u].hasOwnProperty(d)&&(i[d]=t[u][d]);for(var p in i)i.hasOwnProperty(p)&&(c+=p+"="+encodeURIComponent(i[p])+"&");c=c.slice(0,-1),c+="||"}return c=c.slice(0,-2),e+="body="+encodeURIComponent(c)},getHotWord:function(){var t,o=$(".nav-search"),e=this;$.ajax({url:window.ControllerSite+"/classify/hotWord",data:"",dataType:"jsonp",jsonp:"callback",success:function(n){if(n.success){for(var a=0;a<n.data.hotwords.length&&10>a;a++)t=$("<li>"+(n.data.hotwords[a].length<=10?n.data.hotwords[a]:n.data.hotwords[a].slice(0,10)+"...")+"</li>"),t.click(function(t,n){return function(){var a={pclk:"search_req.hotword",pclkp:"pos="+encodeURIComponent(n)+"&w="+encodeURIComponent(t),pn:"search_show",pnp:"q="+encodeURIComponent(t)};o.find("input").val(t),e.search(null,a)}}(n.data.hotwords[a],a)).appendTo(o.find("ul"));o.find("input").attr("placeholder",n.data.defaultWord).on("focus",function(){o.find("ul").show()}).on("blur",function(){setTimeout(function(){o.find("ul").hide()},200)})}}})},search:function(t,o){var e,n=$.trim($("#searchInput").val()),a=[];n&&(a.push({pclk:"home.search",pclkp:"",pn:"search_req",pnp:""}),o&&a.push(o),e=masterGuy.assemblyParam(a),masterGuy.setData(e,function(){window.location.href=window.ControllerSite+"/classify/search.html?query="+encodeURIComponent(encodeURIComponent(n))}))},backBar:function(){$(window).on("scroll",function(){$("body").scrollTop()>0||document.documentElement.scrollTop>0?$(".rightBar-top").fadeIn():$(".rightBar-top").fadeOut()}),$(".rightBar-top").on("click",function(){$("body, html").animate({scrollTop:0},500)})},rightBarPhone:function(t){$(".rightBar-phone").show().click(function(){LT.alertSmall(t,null,{title:"客服电话"})})},rightBarServe:function(t){$(".rightBar-serve").show().find("a").attr("href",t)},shareHandle:function(t){$(".rightBar-share").on("click",function(){$(".shareCon").show()}).show(),$(".shareCon b").click(function(){$(".shareCon").fadeOut()});var o="顶级制造商，奢侈品质，成本价格，赶快去购买吧 >>",e="快将必要分享给小伙伴吧",n=window.location.href,a="http://static.biyao.com/pc/common/img/logo.png";$(".share-code").attr("src",window.ControllerSite+"/RequestAPI/getQRCode?url="+encodeURIComponent(t)),$(".share-qq a").attr("href","http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+encodeURIComponent(n)+"&title="+encodeURIComponent(o)+"&site=&pics="+a),$(".share-sina a").attr("href","http://v.t.sina.com.cn/share/share.php?title="+encodeURIComponent(e)+"&url="+encodeURIComponent(n)+"&source=bookmark&pic="+a+"&searchPic=false"),$(".share-facebook a").attr("href","http://www.facebook.com/sharer.php?u="+encodeURIComponent(n)+"&amp;t="+encodeURIComponent(o)),$(".share-twitter a").attr("href","http://twitter.com/intent/tweet?url="+encodeURIComponent(n)+"&amp;text="+encodeURIComponent(o))},rightBarPos:function(t){$(".rightBar").css("margin-left",t+"px")},jumpLogin:function(){window.location.href=window.ControllerSite+"/account/login.html?returnUrl="+encodeURIComponent(window.location.href)},jumpRegister:function(){window.location.href=window.ControllerSite+"/account/regist.html?returnUrl="+encodeURIComponent(window.location.href)},jumpSupCenter:function(){$.ajax({type:"post",url:window.ControllerSite+"/SupplierCenter/GetSkipto",async:!1,data:{},dataType:"json",success:function(t){window.location.href=t.success?"http://shop.biyao.com":"http://www.biyao.com/minisite/sjzx"},error:function(){window.location.href="http://www.biyao.com/minisite/sjzx"}})},getLoginData:function(){$.ajax({url:window.ControllerSite+"/home/getDataForHomePage",dataType:"jsonp",jsonp:"callback",data:"",success:function(t){1==t.success?($(".user-out").hide(),$("#userName").html(t.data.nickname+"<span></span>"),$(".user-center").css("display","inline-block")):$(".user-out").css("display","inline-block")}})},getShopCarData:function(){$.ajax({dataType:"jsonp",type:"post",jsonp:"jsonpcallback",data:"",url:window.ControllerSite+"/RequestAPI/getCartNum",contentType:"application/x-www-form-urlencoded;charset=utf-8",success:function(t){if(1==t.success){var o=t.data.num;$("#shopCar").html(o||0),$("#subShopCar").html(o||0)}}})},diffDate:function(t){var o=new Date,t=new Date(t),e="",n=o.getTime()-t;if(864e5>n)e=t.format("yyyy-MM-dd")!==o.format("yyyy-MM-dd")?"1天前":t.format("hh:mm");else{var a=parseInt(n/864e5);e=1==a?"1天前":parseInt(n/864e5)+"天前"}return e},msgCenter:function(){window.hasMsgCenterFun=!0;var t=this;$.ajax({dataType:"jsonp",type:"post",jsonp:"jsonpcallback",data:"",url:window.ControllerSite+"/RequestAPI/getMsgCenter",contentType:"application/x-www-form-urlencoded;charset=utf-8",success:function(o){if(1==o.success){var e=o.data.messageList,n="";$("#unread").text(o.data.total),+o.data.total>0?$("#hasMsg").css("visibility","visible"):$("#hasMsg").css("visibility","hidden");for(var a=0;a<e.length;a++){var r=e[a],s="msg-num-99";r.messageCount>=100&&(s="msg-num-100",r.messageCount="99+");var i=t.diffDate(+r.sendTime),c="<a target='_blank' href='"+e[a].live800Url+"'>",l='<div class="msg-li msg-li-border" data-groupId="'+r.groupId+'" data-count="'+r.messageCount+'">'+c+'<div class="msg-imgbox" style="background-image: url('+r.logoUrl+');"><i class="'+s+'">'+r.messageCount+'</i></div><div class="msg-content"><p class="msg-supplier-name">'+r.supplierName+'<span class="msg-time">'+i+'</span></p><p class="msg-txt">'+r.messageContent+"</p></div></a></div>";n+=l}$("#msg-scroll").html(n)}}}),$(".user-msg").on("mouseover",function(){+$("#unread").text()>0&&($(".msg-center-box").show(),LT.scroll({oViweContainer:$("#msg-ul"),oPanelContainer:$("#msg-scroll"),oScrollContainer:$("#scrollOut"),oScrollBtn:$("#scrollIn"),height:320,direction:"y"}))}),$(".user-msg").on("mouseout",function(){$(".msg-center-box").hide()});var o=!0;$(document).on("click",".msg-li",function(){if(o){o=!1;var t=$(this).attr("data-groupId"),e=$(this).attr("data-count"),n=parseInt($("#unread").text());$(".msg-center-box").hide(),$(this).remove(),n-e>0?$("#hasMsg").css("visibility","visible"):$("#hasMsg").css("visibility","hidden"),$("#unread").text(0>n-e?0:n-e),$("#msg-scroll").css("top",0),$("#scrollIn").css("top",0),$.ajax({dataType:"jsonp",type:"post",jsonp:"jsonpcallback",data:{groupId:t},url:window.ControllerSite+"/RequestAPI/setNotify",contentType:"application/x-www-form-urlencoded;charset=utf-8",success:function(t){1==t.success&&($(this).remove(),$("#unread").text(n-e),$("#msg-scroll").css("top",0),$("#scrollIn").css("top",0),o=!0)}})}})},init:function(){var t=this;this.categoryWidth(),this.backBar(),$(".rightBar").show(),this.categoryBarScroll(130,65),!window.MsgCenter&&this.msgCenter(),/(account)/.test(location.pathname)||masterGuy.getHotWord(),$("#supCenter,#supEnter").click(t.jumpSupCenter),$("#loginBtn,#subLoginBtn").click(t.jumpLogin),$("#registBtn,#subRegistBtn").click(t.jumpRegister),$("#searchBtn").click(t.search),$("#searchInput").on("keydown",function(o){13==o.keyCode&&t.search()}),$.cookie("uid")?this.getLoginData():$(".user-out").css("display","inline-block"),($.cookie("uid")||$.cookie("DZVISIT"))&&this.getShopCarData()}};$(function(){masterGuy.init()});